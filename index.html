<script>
        // --- 配置区 ---
        const accessKey = "rZVHN1Gfe2ef1Rl1m7lFfbN5eVVLCa9lI7/lqwkJU+k="; 
        const productID = "3dG9zsAWf"; 
        const deviceName = "test";
        const identifier = "seats"; // 必须与 OneNET 物模型标识符一致

        async function fetchData() {
            // OneNET Studio 属性查询 API
            const url = `https://iot-api.heclouds.com/thingmodel/query-device-property?product_id=${productID}&device_name=${deviceName}`;
            
            try {
                const response = await fetch(url, {
                    method: 'GET',
                    headers: { "authorization": accessKey }
                });
                
                const res = await response.json();
                
                if (res.code === 0) {
                    // 在返回的属性列表中找到 identifier 为 seats 的那一个
                    const prop = res.data.find(item => item.identifier === identifier);
                    
                    if (prop && prop.value !== undefined) {
                        // 核心处理：强制转为字符串，并确保它是 4 位（处理 0000 的情况）
                        let status = String(prop.value).padStart(4, '0');
                        
                        // 调试小技巧：如果你按 F12，能在控制台看到云端传回的真实数据
                        console.log("云端原始数据:", prop.value, "处理后状态:", status);
                        
                        updateUI(status);
                    } else {
                        document.getElementById('update-time').innerText = "未找到 seats 属性数据";
                    }
                } else {
                    document.getElementById('update-time').innerText = "OneNET 报错: " + res.msg;
                }
            } catch (err) {
                document.getElementById('update-time').innerText = "网络连接失败，请检查 API 权限";
            }
        }

        function updateUI(statusStr) {
            // 遍历字符串的 4 位，'0' 为空闲，'1' 为有人
            for (let i = 0; i < 4; i++) {
                const seat = document.getElementById(`seat${i+1}`);
                if (statusStr[i] === '1') {
                    seat.className = 'seat occupied';
                    seat.innerText = `${i+1}号位: 有人`;
                } else {
                    seat.className = 'seat available';
                    seat.innerText = `${i+1}号位: 空闲`;
                }
            }
            document.getElementById('update-time').innerText = "最后更新: " + new Date().toLocaleTimeString();
        }

        // 首次加载并开启 5 秒定时刷新
        fetchData();
        setInterval(fetchData, 5000);
    </script>
