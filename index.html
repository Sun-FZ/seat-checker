<script>
    async function fetchSeatStatus() {
        // 请求你部署后的 Vercel 地址，例如 /api/proxy
        try {
            const response = await fetch('/api/proxy'); 
            const result = await response.json();

            if (result.code === 0 && result.data) {
                // 查找标识符为 seats 的属性
                const prop = result.data.find(item => item.identifier === "seats");
                if (prop && prop.value !== undefined) {
                    const statusStr = String(prop.value).padStart(4, '0');
                    updateUI(statusStr); // 更新界面的函数保持不变
                }
            } else {
                document.getElementById('update-time').innerText = "错误: " + (result.msg || "接口异常");
            }
        } catch (error) {
            document.getElementById('update-time').innerText = "连接云函数失败";
        }
    }

    function updateUI(statusStr) {
        for (let i = 0; i < 4; i++) {
            const seat = document.getElementById(`seat${i+1}`);
            if (statusStr[i] === '1') {
                seat.className = 'seat occupied';
                seat.innerText = `${i+1}号位: 有人`;
            } else {
                seat.className = 'seat available';
                seat.innerText = `${i+1}号位: 空闲`;
            }
        }
        document.getElementById('update-time').innerText = "最后更新: " + new Date().toLocaleTimeString();
    }

    setInterval(fetchSeatStatus, 5000);
    fetchSeatStatus();
</script>
